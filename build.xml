<project name="proj" default="main" basedir=".">
	<property name="rules-folder" value="rules"/>
	<property name="sparql-doc-folder" value="doc"/>
	<property name="jslint-folder" value="jslint"/>
	<property name="fuseki-folder" value="C:/Users/stanie/Documents/jena-fuseki1-1.1.2/"/>
	<property name="fuseki-pages-folder" value="${fuseki-folder}/pages/"/>
	
	<target name="main" depends="jslint,sparql-doc,fuseki"/>

	<taskdef name="jslint" classname="com.googlecode.jslint4java.ant.JSLintTask" classpath="${jslint-folder}/jslint4java-2.0.5.jar" />

	<target name="jslint">
		<jslint haltOnFailure="false" options="sloppy">
		<predef>window,ActiveXObject,XMLHttpRequest,FormData,Blob,alert,document</predef>
		<formatter type="xml" destfile="${jslint-folder}/jslint.xml"/>
		<fileset dir="." includes="dcat-ap_validator.js"/>
		</jslint>
	</target>

	<target name="clean">
		<delete dir="${sparql-doc-folder}"/>
	</target>

	<target name="create" depends="clean">
		<mkdir dir="${sparql-doc-folder}"/>
	</target>
	
	<target name="sparql-doc" depends="create">
		<exec executable="cmd.exe" failonerror="true">
			<arg value="/c"/>
			<arg line="sparql-doc ${rules-folder} ${sparql-doc-folder}"/>
		</exec>
	</target>
	
	<target name="kill-fuseki">
		<exec executable="cmd.exe">
			<arg value="/c"/>
			<arg value="for /f"/>
			<arg value="tokens=5 delims= "/>
			<arg value="%F in ('"/>
			<arg value="netstat -a -o -n^| findstr "/>
			<arg value=":3030'"/>
			<arg line=") do taskkill /F /PID  %F"/>
		</exec>
	</target>
	
	<target name="copy" depends="kill-fuseki">
		<copydir src="." dest="${fuseki-pages-folder}"/>
	</target>

	<target name="fuseki" depends="copy">
		<exec executable="cmd.exe" spawn="true">
			<arg value="/c"/>
			<arg line="java -jar ${fuseki-folder}/fuseki-server.jar --update --port=3030 --pages ${fuseki-pages-folder} --mem /dcat-ap_validator"/>
		</exec>
	</target>
</project>